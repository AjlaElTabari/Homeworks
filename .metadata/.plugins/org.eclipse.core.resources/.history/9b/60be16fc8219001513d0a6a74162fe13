package ba.bitcamp.homework_weekend5.task3;

import javax.naming.OperationNotSupportedException;

import ba.bitcamp.homework_weekend5.task1.Character;
import ba.bitcamp.homework_weekend5.task2.Goal;

public class Protagonist extends Character {
	
	private static final int MAX_ALLIES = 3;
	private Goal goal;
	private Character[] allies;
	private Character enemy;
	
	/**
	 * @param name
	 * @param sex
	 * @param isCapable
	 * @param goal
	 */
	public Protagonist(String name, boolean sex, boolean isCapable, Goal goal) {
		super(name, sex, isCapable);
		this.goal = goal;
		this.enemy = null;
	}

	/**
	 * @return the goal
	 */
	public Goal getGoal() {
		return goal;
	}

	/**
	 * @param goal the goal to set
	 */
	public void setGoal(Goal goal) {
		this.goal = goal;
	}

	/**
	 * @return the allies
	 */
	public Character[] getAllies() {
		return allies;
	}

	/**
	 * @return the enemy
	 */
	public Character getEnemy() {
		return enemy;
	}

	/**
	 * @param enemy the enemy to set
	 */
	public void setEnemy(Character enemy) {
		this.enemy = enemy;
	}

	/**
	 * @param allies[] allies to set
	 */
	public void setAllies(Character[] allies) {
		if(allies.length < MAX_ALLIES){
			this.allies = allies;
		} else {
			
			throw new ArrayIndexOutOfBoundsException("No more allies allowed!");
		}
	}
	
	public void addAlly(Character ally) {		
		Character[] newAllies = null;
		int alliesNo = allies.length;
		if(alliesNo == MAX_ALLIES) {
			throw new ArrayIndexOutOfBoundsException("No more allies allowed!");
		} else {
			newAllies = new Character[alliesNo + 1];
			for (int i = 0; i < newAllies.length; i++) {
				if (i < allies.length) {
					newAllies[i] = allies[i];
				} else {
					newAllies[i] = ally;
				}
			}
		}
		allies = newAllies;
	}
	
	public void attainGoal() {
		if(isAlive()) {
			int chance = 0;
			if(isCapable()){
				if (chance + 40 < 100) {
					chance += 40;
				} else {
					chance = 100;
				}
			
			}
			for (int i = 0; i < allies.length; i++) {
				if(allies[i].isCapable()){
					if (chance + 20 < 100) {
						chance += 20;
					} else {
						chance = 100;
					}
				}
			}
			if(enemy.isCapable()){
				if (chance - 30 > 0) {
					chance -= 30;
				} else {
					chance = 0;
				}
			}
			if(goal.getDifficulty() == Goal.HARD){
				if (chance - 20 > 0) {
					chance -= 20;
				} else {
					chance = 0;
				}
			} else if (goal.getDifficulty() == Goal.IMPOSSIBLE) {
				// if goal is impossible chances will be decreased by 100%,
				// but it cannot go under 0 %, so wi will set it to zero, immediately
				chance = 0;
			}
			hasSucceeded(chance);
		} else {
			System.out.println("Your protagonist is already dead :(");
		}
	}
	
	private void hasSucceeded(int chance) {
		
	}
	
}
